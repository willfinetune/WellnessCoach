<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>WellnessCoach</title>

    <!-- PWA -->
    <link rel="manifest" href="/manifest.webmanifest">
    <meta name="theme-color" content="#43C67E">
    <link rel="apple-touch-icon" href="/icons/icon-192.png">

    <style>
      html,body{margin:0;height:100%;background:#0f172a;color:#e2e8f0;font-family:system-ui}
      h1{margin:16px 12px;font-weight:800;font-size:36px}
      p{margin:0 12px 20px;color:#9aa3af}
      #install{
        position:fixed;left:12px;top:88px;
        padding:12px 16px;border:0;border-radius:10px;
        font-size:14px;background:#43C67E;color:#0b1324;
        box-shadow:0 6px 18px rgba(0,0,0,.25);display:none
      }
    </style>
  </head>
  <body>
    <h1>ðŸ’š WellnessCoach</h1>
    <p>This small installable launcher opens the full app.</p>
    <button id="install">Install</button>

    <script>
      // 1) Register SW at the ROOT so it controls all pages
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js').catch(console.error);
        });
      }

      // 2) Handle beforeinstallprompt + show button
      let deferredPrompt = null;
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        const btn = document.getElementById('install');
        btn.style.display = 'inline-block';
      });

      // 3) Click handler to show the native install prompt
      document.getElementById('install').addEventListener('click', async () => {
        const btn = document.getElementById('install');
        btn.disabled = true;
        try {
          if (deferredPrompt) {
            await deferredPrompt.prompt();
            await deferredPrompt.userChoice;
            deferredPrompt = null;
          }
        } finally {
          btn.disabled = false;
        }
      });
    </script>
  </body>
</html>
